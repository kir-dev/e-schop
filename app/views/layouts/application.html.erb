<!DOCTYPE html>
<html lang="hu">
  <head>
    <title>ESchop</title>
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track': 'reload' %>
    <%= javascript_include_tag 'application', 'data-turbolinks-track': 'reload' %>

    <style>
      body {
        margin:0;
        padding-top: 40px;
      }
      .navbar ul {
        position: fixed;
        top: 0;
        width: 100%;
        list-style-type: none;
        margin: 0;
        padding: 0;
        background-color: #333;
      }

      .navbar li {
        text-align: center;
        display: inline;
      }

      .navbar li a, .dropbtn {
        display: inline-block;
        color: white;
        text-align: center;
        padding: 6px 35px;
        text-decoration: none;
      }

      .navbar li a:hover, .dropdown:hover .dropbtn {
        background-color: red;
      }

      .navbar li.dropdown {
        display: inline-block;
      }

      .dropdown-content {
        display: none;
        position: absolute;
        background-color: #f9f9f9;
        min-width: 160px;
        box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
        z-index: 1;
      }

      li.dropdown .dropdown-content a {
        color: black;
        padding: 12px 16px;
        text-decoration: none;
        display: block;
        text-align: left;
      }

      .dropdown-content a:hover {background-color: #f1f1f1;}

      .dropdown:hover div.dropdown-content {
        display: block;
      }
    </style>
  </head>

  <body>
  <div style = "text-align: center" class="navbar">
    <ul class="navbar">
      <li> <%= link_to 'E-schop', goods_path %> </li>
      <li> <%= link_to 'Étel', {action: 'food', controller: 'goods'} %> </li>
      <li> <%= link_to 'Ital', {action: 'drink', controller: 'goods'} %> </li>
      <li> <%= link_to 'Egyéb', {action: 'else', controller: 'goods'} %> </li>
      <li> <%= link_to raw('&#8981'), {action: 'search', controller: 'goods'} %> </li>
      <% if current_user.nil? %>
        <li> <%= link_to 'Bejelentkezés', user_authsch_omniauth_authorize_path %> </li>
      <% else %>
        <li class="dropdown">
          <a href="javascript:void(0)" class="dropbtn"><%= current_user.username %></a>
          <div class="dropdown-content">
            
          <% @purchases = Purchase.all %>
          <% @goods = Good.all %>
          <% cart_num = 0 %>
          <% @purchases.each do |p| %>
              <% if p.buyer_id == current_user.id%>
                <% cart_num += 1 %>
              <% end %>
          <%end%>
          <% felirat = "Kosaram (" + cart_num.to_s + ")" %>
          <%=link_to felirat, {action: 'my_cart', controller: 'users'} %>

          <% good_num = 0 %>
          <% @goods.each do |g| %>
              <% if g.seller_id == current_user.id %>
                <% good_num += 1 %>
              <% end %>
          <%end%>
          <% felirat = "Termékeim (" + good_num.to_s + ")" %>
          <%=link_to felirat, {action: 'my_goods', controller: 'users'} %>

          <% good_num = 0 %>
          <% @purchases.each do |p| %>
              <% if Good.with_deleted.find_by_id(p.good_id).seller_id == current_user.id %>
                <% good_num += 1 %>
              <% end %>
          <%end%>
          <% felirat = "Megrendelt termékeim (" + good_num.to_s + ")" %>
          <%=link_to felirat, {action: 'sold_goods', controller: 'users'} %>

          <%= link_to 'Új termék felvétele', {action: 'new', controller: 'goods'} %>
          
          <% unread_num = current_user.unread_inbox_count %>
          <% if unread_num > 0 %>
            <%= link_to "Beszélgetések (" + unread_num.to_s + ")", conversations_path(current_user) %>
          <% else %>
            <%= link_to "Beszélgetések", conversations_path(current_user) %>
          <% end %>
          
          <%= link_to 'Kijelentkezés', destroy_user_session_path, method: :delete %>
          </div>
        </li>
      <% end %>
    </ul>
  </div>
    <p class="notice" style = "margin:0px"><%= notice %></p>
    <p class="alert" style = "margin:0px"><%= alert %></p>
    <%= yield %>
  </body>
</html>
